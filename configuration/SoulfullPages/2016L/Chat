<div id="chat-container" class="chat chat-container ng-scope collapsed" ng-modules="robloxApp, chat" ng-controller="chatController" ng-class="{'collapsed': chatLibrary.chatLayout.collapsed, 
                'inApp': chatLibrary.inApp,
                'tablet': chatLibrary.tabletInApp}">
<div id="chat-data-model" class="hidden ng-isolate-scope" chat-data="" chat-view-model="chatViewModel" chat-library="chatLibrary" data-userid="%userid%" data-domain="%url%" data-gamespagelink="http://www.%url%/games" data-chatdomain="http://chat.%url%" data-numberofmembersforpartychrome="6" data-avatarheadshotsmultigetlimit="100" data-userpresencemultigetlimit="100" data-intervalofchangetitleforpartychrome="500" data-spinner="//images.rbxcdn.com/4bed93c91f909002b1f17f05c0ce13d1.gif" data-notificationsdomain="http://realtime.%url%/" data-devicetype="Computer" data-inapp="false" data-togglechatbarenabled="true" data-smallerchatenabled="true" data-cleanpartyfromconversationenabled="false" data-parytchromedisplaytimestampinterval="300000">
</div>
    <div id="chat-main" class="chat-main" ng-class="{'chat-main-empty': chatLibrary.chatLayout.chatLandingEnabled}" chat-bar="">
        <div id="chat-header" class="chat-windows-header chat-header" ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.headerStyle : ''">
            <div class="chat-header-label" ng-click="toggleChatContainer()" ng-hide="chatLibrary.inApp">
                <span class="font-bold chat-header-title">Chat &amp; Party</span>
            </div>
            <div class="chat-header-label ng-hide" ng-click="toggleChatContainer()" ng-show="chatLibrary.inApp">
                <span class="font-bold chat-header-title">Chat</span>
            </div>
            <div class="chat-header-action">
                <span class="notification-red ng-binding ng-hide" ng-show="chatLibrary.chatLayout.collapsed &amp;&amp; chatViewModel.conversationCount > 0"></span>
                <span id="chat-group-create" class="icon-chat-group-create ng-hide" ng-hide="chatLibrary.chatLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.chatLandingEnabled || chatLibrary.chatLayout.pageDataLoading" ng-click="launchDialog(newGroup.layoutId)" data-toggle="tooltip" title="" data-original-title="Add at least 2 people to create chat group"></span>
            </div>
        </div>
        <!-- ngIf: !chatLibrary.chatLayout.chatLandingEnabled --><div id="chat-body" class="chat-body ng-scope ng-hide" ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.chatBodyHeight : ''" ng-hide="chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.pageDataLoading" ng-if="!chatLibrary.chatLayout.chatLandingEnabled">
            <div class="chat-search" ng-class="{'chat-search-focus': chatLibrary.chatLayout.searchFocus}">
                <input type="text" placeholder="Search" class="chat-search-input ng-pristine ng-valid" ng-model="chatViewModel.searchTerm" ng-focus="chatLibrary.chatLayout.searchFocus = true">
                <span class="icon-chat-search"></span>
                <span class="icon-chat-cancel-search" ng-click="cancelSearch()"></span>
            </div>
            <button id="chat-group-create-btn" type="button" class="btn btn-control-md" ng-click="launchDialog(newGroup.layoutId)" title="Add at least 2 people to create chat group">
                <span>Create Chat Group</span>
            </button>
            <div id="chat-friend-list" class="rbx-scrollbar chat-friend-list ng-scope mCustomScrollbar _mCS_2 mCS_no_scrollbar" lazy-load=""><div id="mCSB_2" class="mCustomScrollBox mCS-light mCSB_vertical mCSB_inside" tabindex="0"><div id="mCSB_2_container" class="mCSB_container mCS_y_hidden mCS_no_scrollbar_y" style="position:relative; top:0; left:0;" dir="ltr">
                <ul id="chat-friends" class="chat-friends">
                    <!-- ngRepeat: chatUser in chatUserDict | orderList: chatLibrary.chatLayoutIds | filter : {name: chatViewModel.searchTerm} -->
                </ul>
                <div class="chat-loading loading-bottom ng-hide" ng-show="chatLibrary.chatLayout.isChatLoading">
                    <img ng-src="//images.rbxcdn.com/4bed93c91f909002b1f17f05c0ce13d1.gif" alt="loading ..." class="mCS_img_loaded" src="//images.rbxcdn.com/4bed93c91f909002b1f17f05c0ce13d1.gif">
                </div>
            </div><div id="mCSB_2_scrollbar_vertical" class="mCSB_scrollTools mCSB_2_scrollbar mCS-light mCSB_scrollTools_vertical" style="display: none;"><div class="mCSB_draggerContainer"><div id="mCSB_2_dragger_vertical" class="mCSB_dragger" style="position: absolute; min-height: 30px; top: 0px;" oncontextmenu="return false;"><div class="mCSB_dragger_bar" style="line-height: 30px;"></div></div><div class="mCSB_draggerRail"></div></div></div></div></div>
        </div><!-- end ngIf: !chatLibrary.chatLayout.chatLandingEnabled -->
        <div id="chat-disconnect" class="chat-disconnect" ng-show="chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.pageDataLoading">
            <p ng-show="chatLibrary.chatLayout.errorMaskEnable" class="ng-hide">Trying to connect ...</p>
            <img ng-src="//images.rbxcdn.com/4bed93c91f909002b1f17f05c0ce13d1.gif" alt="loading ..." src="//images.rbxcdn.com/4bed93c91f909002b1f17f05c0ce13d1.gif">
        </div>
        <!-- ngIf: chatLibrary.chatLayout.chatLandingEnabled -->
    </div>
    <script type="text/ng-template" id="chat-bar">
    <div id="chat-main" class="chat-main"
         ng-class="{'chat-main-empty': chatLibrary.chatLayout.chatLandingEnabled}" ng-cloak>
        <div id="chat-header"
             class="chat-windows-header chat-header"
             ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.headerStyle : ''">
            <div class="chat-header-label"
                 ng-click="toggleChatContainer()"
                      ng-hide="chatLibrary.inApp">
                <span class="font-bold chat-header-title">Chat & Party</span>
            </div>
            <div class="chat-header-label"
                 ng-click="toggleChatContainer()"
                      ng-show="chatLibrary.inApp">
                <span class="font-bold chat-header-title">Chat</span>
            </div>
            <div class="chat-header-action">
                <span class="notification-red"
                      ng-show="chatLibrary.chatLayout.collapsed && chatViewModel.conversationCount > 0"
                      ng-cloak>{{chatViewModel.conversationCount}}</span>
                <span id="chat-group-create"
                      class="icon-chat-group-create"
                      ng-hide="chatLibrary.chatLayout.collapsed || chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.chatLandingEnabled || chatLibrary.chatLayout.pageDataLoading"
                      ng-click="launchDialog(newGroup.layoutId)"
                      data-toggle="tooltip"
                      title="Add at least 2 people to create chat group"
                      ng-cloak></span>
            </div>
        </div>
        <div id="chat-body"
             class="chat-body"
             ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.chatBodyHeight : ''"
             ng-hide="chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.pageDataLoading"
             ng-if="!chatLibrary.chatLayout.chatLandingEnabled">
            <div class="chat-search"
                 ng-class="{'chat-search-focus': chatLibrary.chatLayout.searchFocus}">
                <input type="text"
                       placeholder="Search"
                       class="chat-search-input"
                       ng-model="chatViewModel.searchTerm"
                       ng-focus="chatLibrary.chatLayout.searchFocus = true" />
                <span class="icon-chat-search"></span>
                <span class="icon-chat-cancel-search"
                      ng-click="cancelSearch()"></span>
            </div>
            <button id="chat-group-create-btn"
                    type="button"
                    class="btn btn-control-md"
                    ng-click="launchDialog(newGroup.layoutId)"
                    title="Add at least 2 people to create chat group"
                    ng-cloak>
                <span>Create Chat Group</span>
            </button>
            <div id="chat-friend-list" class="rbx-scrollbar chat-friend-list" lazy-load>
                <ul id="chat-friends" class="chat-friends">
                    <li ng-repeat="chatUser in chatUserDict | orderList: chatLibrary.chatLayoutIds | filter : {name: chatViewModel.searchTerm}"
                        class="chat-friend">
                        <div ng-click="launchDialog(chatUser.layoutId)"
                             ng-if="chatUser.dialogType === dialogType.CHAT && chatUser.isConversation"
                             class="chat-friend-container">
                            <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar">
                                <img ng-src="{{chatLibrary.friendsDict[chatUser.displayUserId].AvatarThumb.Url}}"
                                     class="avatar-card-image chat-avatar"
                                     thumbnail="chatLibrary.friendsDict[chatUser.displayUserId].AvatarThumb"
                                     image-retry
                                     ng-if="chatUser.isConversation">
                                <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[chatUser.displayUserId].UserPresenceType]['className']"></div>
                            </div>
                            <div class="chat-friend-info">
                                <span class="text-overflow chat-friend-name" ng-if="chatUser.isConversation">{{chatUser.name}}</span>
                                <span class="small text-overflow chat-friend-message"
                                      ng-class="{'font-bold': chatUser.HasUnreadMessages}"
                                      ng-bind-html="chatUser.DisplayMessage.Content"
                                      ng-if="chatUser.DisplayMessage"></span>
                            </div>
                        </div>

                        <div ng-click="launchDialog(chatUser.layoutId)"
                             ng-if="chatUser.dialogType === dialogType.GROUPCHAT && chatUser.isConversation"
                             class="chat-friend-container chat-friend-groups">
                            <div class="chat-friend-avatar">
                                <ul class="avatar-group card-plain chat-avatar-groups"
                                    ng-class="{'avatar-double': chatUser.userIds.length == 2, 
                                                'avatar-triple': chatUser.userIds.length == 3, 
                                                'avatar-all': chatUser.userIds.length >= 4}">
                                    <li ng-repeat="userId in chatUser.userIds | limitTo : 4"
                                        class="avatar-item chat-avatar">
                                        <img ng-src="{{chatLibrary.friendsDict[userId].AvatarThumb.Url}}"
                                             thumbnail="chatLibrary.friendsDict[userId].AvatarThumb"
                                             class="avatar-card-image"
                                             image-retry>
                                    </li>
                                </ul>
                            </div>
                            <div class="chat-friend-info">
                                <span class="text-overflow chat-friend-name">{{chatUser.name}}</span>
                                <span class="small text-overflow chat-friend-message"
                                      ng-class="{'font-bold': chatUser.HasUnreadMessages}"
                                      ng-bind-html="chatUser.DisplayMessage.Content"
                                      ng-if="chatUser.DisplayMessage"></span>
                            </div>
                        </div>

                        <div ng-click="launchDialog(chatUser.layoutId)"
                             ng-if="chatUser.dialogType === dialogType.PARTY && chatUser.isConversation"
                             class="chat-friend-container">
                            <div class="chat-friend-avatar chat-party-avatar">
                                <span class="icon-chat-party-avatar"></span>
                            </div>
                            <div class="chat-friend-info">
                                <span class="text-overflow chat-friend-name">{{chatUser.name}}</span>
                                <span class="small text-overflow chat-friend-message"
                                      ng-class="{'font-bold': chatUser.HasUnreadMessages}"
                                      ng-bind-html="chatUser.DisplayMessage.Content"
                                      ng-if="chatUser.DisplayMessage"></span>
                            </div>
                        </div>
                        <div ng-click="launchDialog(chatUser.layoutId)"
                             ng-if="chatUser.dialogType === dialogType.PENDINGPARTY  && chatUser.isConversation"
                             class="chat-friend-container chat-pending-party">
                            <div class="chat-friend-avatar">
                                <ul class="avatar-group card-plain chat-avatar-groups"
                                    ng-class="{'avatar-double': chatUser.userIds.length == 1, 
                                                'avatar-triple': chatUser.userIds.length == 2, 
                                                'avatar-all': chatUser.userIds.length >= 3}">
                                    <li ng-repeat="userId in chatUser.userIds | limitTo : 3"
                                        class="avatar-item chat-avatar">
                                        <img ng-src="{{chatLibrary.friendsDict[userId].AvatarThumb.Url}}"
                                             thumbnail="chatLibrary.friendsDict[userId].AvatarThumb"
                                             class="avatar-card-image"
                                             image-retry>
                                    </li>
                                    <li class="chat-avatar-party-icon">
                                        <span class="icon-chat-party-avatar"></span>
                                    </li>
                                </ul>
                            </div>
                            <div class="chat-friend-info">
                                <span class="text-overflow chat-friend-name">{{chatUser.name}}</span>
                                <span class="small text-overflow chat-friend-message party-pending-msg"
                                      ng-if="chatUser.incomingPartyInvite">{{chatUser.pendingPartyMsg}}</span>
                                <span class="small text-overflow chat-friend-message"
                                      ng-class="{'font-bold': chatUser.HasUnreadMessages}"
                                      ng-bind-html="chatUser.DisplayMessage.Content"
                                      ng-if="chatUser.DisplayMessage && !chatUser.incomingPartyInvite"></span>
                            </div>
                        </div>
                        <div ng-click="launchDialog(chatUser.layoutId)"
                             ng-if="!chatUser.isConversation"
                             class="chat-friend-container">
                            <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar">
                                <img ng-src="{{chatUser.AvatarThumb.Url}}" class="avatar-card-image chat-avatar"
                                     thumbnail="chatUser.AvatarThumb"
                                     image-retry>
                                <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[chatUser.UserPresenceType]['className']"></div>

                            </div>
                            <div class="chat-friend-info">
                                <span class="text-overflow chat-friend-name">{{chatUser.name}}</span>
                                <span class="xsmall text-overflow chat-friend-message">{{userPresenceTypes[chatUser.UserPresenceType].title}}</span>
                            </div>
                        </div>
                    </li>
                </ul>
                <div class="chat-loading loading-bottom"
                     ng-show="chatLibrary.chatLayout.isChatLoading">
                    <img ng-src="{{chatLibrary.spinner}}" alt="loading ...">
                </div>
            </div>
        </div>
        <div id="chat-disconnect"
             class="chat-disconnect"
             ng-show="chatLibrary.chatLayout.errorMaskEnable || chatLibrary.chatLayout.pageDataLoading"
             ng-cloak>
            <p ng-show="chatLibrary.chatLayout.errorMaskEnable">Trying to connect ...</p>
            <img ng-src="{{chatLibrary.spinner}}" alt="loading ...">
        </div>
        <div id="chat-empty-list"
             class="chat-disconnect"
             ng-hide="chatLibrary.chatLayout.errorMaskEnable"
             ng-if="chatLibrary.chatLayout.chatLandingEnabled">
            <span class="icon-chat-friends"></span>
            <p class="text-lead">Make friends to start chatting and partying!</p>
        </div>
    </div>
</script>
    <div id="dialogs" class="dialogs ng-scope" ng-controller="dialogsController">
        <!-- ngRepeat: chatLayoutId in chatLibrary.layoutIdList -->
        <script type="text/ng-template" id="chat-abuse-report">
    <div class="dialog-report-container"
         ng-show="dialogLayout.isConfirmationOn">
        <div class="dialog-report-content">
            <h4>Continue to report?</h4>
            <button id="chat-abuse-report-btn"
                    class="btn-primary-xs"
                    ng-click="abuseReport(null, true)">
                Report
            </button>

            <button class="btn-control-xs"
                    ng-click="dialogLayout.isConfirmationOn = false">
                Cancel
            </button>
        </div>
    </div>
</script>

        <script type="text/ng-template" id="chat-friends-selection">
    <div class="chat-friends-container"
        ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.chatBodyHeight : ''">
        <div class="chat-search"
             ng-class="{'group-select-container' : dialogData.selectedUserIds.length > 0}"
             group-select>
            <div class="group-select">
                <ul class="group-select-friends">
                    <li class="small group-select-friend"
                        ng-repeat="userId in dialogData.selectedUserIds"
                        ng-click="selectFriends(userId)">
                        {{dialogData.selectedUsersDict[userId].Username}}
                        <span class="icon-chat-cancel-search group-select-cancel"></span>
                    </li>
                </ul>
                <input type="text"
                       placeholder="Search"
                       class="chat-search-input"
                       focus-me="{{dialogLayout.focusMeEnabled}}"
                       ng-model="dialogData.searchTerm" />
            </div>
            <button id="friends-selection-btn"
                    class="btn-fixed-width btn-secondary-xs friends-invite-btn"
                    ng-disabled="dialogLayout.inviteBtnDisabled"
                    ng-click="sendInvite()"
                    ng-bind="dialogData.dialogType == dialogType.NEWGROUPCHAT ? 'Create' : 'Add'">
            </button>
        </div>
        
        <div ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.friendsListStyle : ''">
            <div id="scrollbar_friend_{{dialogData.dialogType}}_{{dialogData.layoutId}}"
                 class="rbx-scrollbar chat-friend-list"
                 friends-lazy-load>
                <ul class="chat-friends">
                    <li ng-repeat="friend in chatLibrary.friendsDict | orderList: dialogData.friendIds  | filter: {Username: dialogData.searchTerm}"
                        class="chat-friend">
                        <div class="chat-friend-container chat-friend-select"
                             ng-click="selectFriends(friend.Id)">
                            <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar">
                                <img ng-src="{{friend.AvatarThumb.Url}}"
                                     thumbnail="friend.AvatarThumb"
                                     image-retry
                                     class="avatar-card-image chat-avatar">
                                <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[friend.UserPresenceType]['className']"></div>
                            </div>
                            <div class="chat-friend-info">
                                <span class="text-overflow chat-friend-name">{{friend.Username}}</span>
                                <span class="small text-overflow chat-friend-message">{{userPresenceTypes[friend.UserPresenceType].title}}</span>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</script>
        <script type="text/ng-template" id="chat-dialog">
    <div id="dialog-container" class="dialog-container"
         ng-class="{'group-has-banner': dialogData.isPartyExisted || dialogData.partyInGame,
                    'dialog-party': dialogData.dialogType == dialogType.PARTY,
                    'collapsed': dialogLayout.collapsed && chatLibrary.deviceType === deviceType.COMPUTER,
                    'active': dialogLayout.active && !dialogLayout.hasFocus}"
         ng-controller="dialogController"
         ng-focus="focusDialog()">
        <div class="dialog-main">
            <div class="chat-windows-header dialog-header"
             ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.headerStyle : ''">
                <div class="chat-header-back"
                        ng-click="closeDialog(dialogData.layoutId)"
                        ng-show="chatLibrary.inApp && !chatLibrary.tabletInApp">
                    <span class="icon-chat-arrow-left"></span>
                </div>
                <div class="chat-header-label">
                    <span class="icon-chat-party-label"
                          ng-show="dialogData.dialogType == dialogType.PARTY"
                          title="Party"
                          ng-cloak></span>
                    <span id="chat-title"
                          class="text-overflow chat-header-title dialog-header-title"
                          ng-click="toggleDialogContainer()"
                          ng-if="dialogData.dialogType != dialogType.PARTY">
                        <a class="font-bold"
                           ng-click="linkToProfile($event)"
                           ng-class="{'disabled': chatLibrary.inApp}"
                           ng-href="{{dialogData.nameLink}}">{{dialogData.name}}</a>
                    </span>
                    <span id="party-title"
                          class="font-bold text-overflow chat-header-title dialog-header-title"
                          ng-click="toggleDialogContainer()"
                          ng-if="dialogData.dialogType == dialogType.PARTY">
                        {{dialogData.name}}
                    </span>
                </div>
                <div class="chat-header-action"
                     chat-setting>
                    <span class="icon-chat-close"
                          ng-click="closeDialog(dialogData.layoutId)"
                          ng-hide="chatLibrary.inApp"
                          data-toggle="tooltip"
                          title="Close"></span>
                    <span class="icon-chat-setting"
                          data-toggle="popover"
                          data-bind="group-settings-{{dialogData.Id}}"
                          ng-hide="(dialogLayout.collapsed && chatLibrary.deviceType === deviceType.COMPUTER) || chatLibrary.chatLayout.errorMaskEnable"></span>
                    <div class="rbx-popover-content" data-toggle="group-settings-{{dialogData.Id}}">
                        <ul class="dropdown-menu" role="menu">
                            <li>
                                <a id="abuse-report"
                                   ng-click="abuseReport(dialogData.userIds[0], false)">Report Abuse</a>
                            </li>
                            <li>
                                <a id="leave-group"
                                   ng-click="leaveGroup()"
                                   ng-if="dialogData.dialogType === dialogType.PARTY">Leave Party</a>
                            </li>
                        </ul>
                    </div>
                    <span id="create-party"
                          class="icon-chat-party-label"
                          ng-click="sendInvite(dialogData.layoutId)"
                          data-toggle="tooltip"
                          title="Play Together"
                          ng-hide="dialogData.party || (dialogLayout.collapsed && chatLibrary.deviceType === deviceType.COMPUTER)  || chatLibrary.chatLayout.errorMaskEnable || chatLibrary.inApp"></span>
                </div>
            </div>

            <div id="dialog-member-header"
                 class="dialog-member-header"
                 ng-show="dialogData.isPartyExisted && !dialogData.partyInGame"
                 ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.bannerStyle : ''">
                <ul class="group-members">
                    <li class="avatar avatar-headshot-sm card-plain group-member"
                        title="{{chatLibrary.friendsDict[userId].Username}}{{dialogData.membersDict[userId].statusTooltip}}"
                        ng-repeat="userId in dialogData.userIds">
                        <img ng-src="{{chatLibrary.friendsDict[userId].AvatarThumb.Url}}"
                             thumbnail="chatLibrary.friendsDict[userId].AvatarThumb"
                             image-retry
                             alt="{{chatLibrary.friendsDict[userId].Username}}"
                             class="avatar-card-image group-member-avatar"
                             ng-class="{'group-leader': dialogData.membersDict[userId].memberStatus === memberStatus.LEADER,
                                        'group-pending':dialogData.membersDict[userId].memberStatus === memberStatus.PENDING}">
                    </li>
                </ul>
                <a id="find-game"
                   class="btn-primary-xs"
                   ng-show="dialogData.dialogType === dialogType.PARTY && dialogData.party.LeaderUser.Id === chatLibrary.userId"
                   ng-href="{{chatLibrary.gamesPageLink}}">Find Game</a>
                <a id="join-party"
                   class="btn-control-xs"
                   ng-hide="dialogData.dialogType === dialogType.PARTY || !dialogData.party"
                   ng-click="joinParty()">
                    Join Party
                </a>
            </div>

            <div id="party-ingame-header"
                 class="party-ingame-header"
                 ng-show="dialogData.dialogType === dialogType.PARTY && dialogData.isPartyExisted && dialogData.partyInGame"
                 ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.bannerStyle : ''">
                <img ng-src="{{dialogData.placeThumbnail.Url}}"
                     thumbnail="dialogData.placeThumbnail" image-retry
                     class="party-ingame-thumbnail">
                <div class="party-ingame-label"
                     ng-class="{'party-ingame-member': chatLibrary.userId !== dialogData.party.LeaderUser.Id}">
                    <span class="small">Playing</span>
                    <span class="small font-bold text-overflow party-ingame-name">{{dialogData.party.GameName}}</span>
                </div>
                <a id="join-game"
                   class="btn-control-xs"
                   ng-hide="chatLibrary.userId === dialogData.party.LeaderUser.Id"
                   ng-click="joinGame()">
                    Join Game
                </a>
            </div>
            <div id="scrollbar_{{dialogData.dialogType}}_{{dialogData.layoutId}}"
                 class="rbx-scrollbar dialog-body"
                 ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.dialogStyle : dialogLayout.defaultStyle.dialogStyle"
                 dialog-lazy-load>
                <ul class="dialog-messages">
                    <li class="dialog-message-container"
                        ng-repeat="message in dialogData.ChatMessages | reverse"
                        ng-class="{'message-inbound': message.SenderUserId != chatLibrary.userId && !message.isSystemMessage,
                                    'system-message': message.isSystemMessage,
                                    'message-cluster-master': message.isClusterMaster}">
                        <div class="text-date-hint" ng-hide="!message.displayTimeStamp">{{message.displayTimeStamp}}</div>
                        <div class="small dialog-message dialog-message-content dialog-triangle"
                             ng-bind-html="message.Content"
                             ng-hide="message.isSystemMessage"></div>
                        <div class="xsmall dialog-sending" ng-show="message.sendingMessage">Sending...</div>
                        <div class="xsmall text-error dialog-sending" ng-show="message.sendMessageHasError"
                             ng-bind="message.error || 'Error'"></div>
                        <span class="system-message-content"
                              ng-show="message.isSystemMessage"
                              ng-bind-html="message.Content"></span>
                    </li>
                </ul>
            </div>
            <div class="chat-loading loading-top"
                 ng-show="dialogLayout.isChatLoading">
                <img ng-src="{{chatLibrary.spinner}}" alt="loading ...">
            </div>
            <div class="dialog-input-container"
                ng-focus="toggleDialogFocusStatus(true)"
                ng-blur="toggleDialogFocusStatus(false)"
                ng-style="chatLibrary.inApp? dialogLayout.inAppStyle.inputStyle : dialogLayout.defaultStyle.inputStyle">
                <textarea id="dialog-input"
                          msd-elastic
                          focus-me="{{dialogLayout.focusMeEnabled}}"
                          placeholder="Send a message ..."
                          ng-model="dialogData.messageForSend"
                          key-press-enter="keyPressEnter($event)"
                          class="dialog-input"
                          maxlength="{{dialogLayout.limitCharacterCount}}"
                          ng-disabled="chatLibrary.chatLayout.errorMaskEnable"
                          ng-style="chatLibrary.inApp? dialogLayout.inAppStyle.inputStyle : dialogLayout.defaultStyle.inputStyle"></textarea>
                <button class="btn-secondary-sm message-send-btn"
                        ng-show="chatLibrary.inApp && dialogData.messageForSend && dialogData.messageForSend.length > 0"
                        remove-focus>
                    Send
                </button>
            </div>

            <div abuse-report></div>
        </div>
    </div>
</script>
        <script type="text/ng-template" id="chat-group-dialog">
    <div class="dialog-container group-dialog"
         ng-class="{'group-has-banner': dialogData.isPartyExisted || dialogData.partyInGame,
                    'dialog-party': dialogData.dialogType == dialogType.PARTY,
                    'collapsed': dialogLayout.collapsed && chatLibrary.deviceType === deviceType.COMPUTER,
                    'active': dialogLayout.active && !dialogLayout.hasFocus}"
         ng-controller="dialogController">
        <div class="dialog-main"
             ng-hide="dialogLayout.isConfirmationOn || dialogLayout.lookUpMembers || dialogData.addMoreFriends">
            <div class="chat-windows-header dialog-header"
                ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.headerStyle : ''">
                <div class="chat-header-back"
                        ng-click="closeDialog(dialogData.layoutId)"
                        ng-show="chatLibrary.inApp && !chatLibrary.tabletInApp">
                    <span class="icon-chat-arrow-left"></span>
                </div>
                <div class="chat-header-label">
                    <span class="icon-chat-party-label"
                          ng-show="dialogData.dialogType == dialogType.PARTY"
                          title="Party"
                          ng-cloak></span>
                    <span class="icon-chat-group-label"
                          ng-show="dialogData.dialogType != dialogType.PARTY"
                          title="Group Chat"
                          ng-cloak></span>
                    <span id="party-title"
                          class="font-bold text-overflow dialog-header-title"
                          title="{{dialogData.partyName}}"
                          ng-click="toggleDialogContainer()" ng-if="dialogData.dialogType == dialogType.PARTY">{{dialogData.partyName}}</span>
                    <span id="group-chat-title"
                          class="font-bold text-overflow dialog-header-title"
                          title="{{dialogData.groupName}}"
                          ng-click="toggleDialogContainer()" ng-if="dialogData.dialogType != dialogType.PARTY">{{dialogData.groupName}}</span>
                </div>
                <div class="chat-header-action"
                     chat-setting>
                    <span class="icon-chat-close"
                          ng-click="closeDialog(dialogData.layoutId)"
                          data-toggle="tooltip"
                          ng-hide="chatLibrary.inApp"
                          title="Close"></span>
                    <span class="icon-chat-setting"
                          data-toggle="popover"
                          data-bind="group-settings-{{dialogData.Id}}"
                          ng-hide="(dialogLayout.collapsed && chatLibrary.deviceType === deviceType.COMPUTER) || chatLibrary.chatLayout.errorMaskEnable"></span>
                    <div class="rbx-popover-content" data-toggle="group-settings-{{dialogData.Id}}">
                        <ul class="dropdown-menu" role="menu">
                            <li><a id="add-friends" ng-click="addFriends()">Add Friends</a></li>
                            <li><a id="view-participants" ng-click="viewParticipants()">View Participants</a></li>
                            <li>
                                <a id="leave-group" ng-click="leaveGroup()" ng-bind="dialogData.dialogType === dialogType.PARTY ? 'Leave Party' : 'Leave Group'"></a>
                            </li>
                        </ul>
                    </div>
                    <span id="create-party"
                          class="icon-chat-party-label"
                          ng-click="sendInvite(dialogData.layoutId)"
                          data-toggle="tooltip"
                          title="Play Together"
                          ng-hide="dialogData.party || (dialogLayout.collapsed && chatLibrary.deviceType === deviceType.COMPUTER) || chatLibrary.chatLayout.errorMaskEnable || chatLibrary.inApp"></span>
                </div>
            </div>
            <div id="dialog-member-header"
                 class="dialog-member-header"
                 ng-show="dialogData.isPartyExisted && (!dialogData.partyInGame || dialogData.dialogType === dialogType.PENDINGPARTY)"
                 ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.bannerStyle : ''">
                <ul class="group-members">
                    <li class="avatar avatar-headshot-sm card-plain group-member"
                        title="{{chatLibrary.friendsDict[userId].Username}}{{dialogData.membersDict[userId].statusTooltip}}"
                        ng-repeat="userId in dialogData.userIds | limitTo: dialogLayout.limitMemberDisplay">
                        <img ng-src="{{chatLibrary.friendsDict[userId].AvatarThumb.Url}}"
                             thumbnail="chatLibrary.friendsDict[userId].AvatarThumb"
                             image-retry
                             alt="{{chatLibrary.friendsDict[userId].Username}}"
                             class="avatar-card-image group-member-avatar"
                             ng-class="{'group-leader': dialogData.membersDict[userId].memberStatus === memberStatus.LEADER,
                                        'group-pending':dialogData.membersDict[userId].memberStatus === memberStatus.PENDING}">
                    </li>
                    <li ng-show="dialogData.userIds.length === (dialogLayout.limitMemberDisplay + 1)"
                        title="{{chatLibrary.friendsDict[dialogData.userIds[dialogLayout.limitMemberDisplay]].Username}}{{dialogData.membersDict[dialogData.userIds[dialogLayout.limitMemberDisplay]].statusTooltip}}"
                        class="avatar avatar-headshot-sm card-plain group-member">
                        <img ng-src="{{chatLibrary.friendsDict[dialogData.userIds[dialogLayout.limitMemberDisplay]].AvatarThumb.Url}}"
                             thumbnail="chatLibrary.friendsDict[dialogData.userIds[dialogLayout.limitMemberDisplay]].AvatarThumb"
                             image-retry
                             alt="{{chatLibrary.friendsDict[dialogData.userIds[dialogLayout.limitMemberDisplay]].Username}}"
                             class="avatar-card-image group-member-avatar"
                             ng-class="{'group-pending': dialogData.membersDict[dialogData.userIds[dialogLayout.limitMemberDisplay]].memberStatus === memberStatus.PENDING}">
                    </li>
                    <li ng-show="dialogData.userIds.length > (dialogLayout.limitMemberDisplay + 1)"
                        ng-click="dialogLayout.lookUpMembers = !dialogLayout.lookUpMembers"
                        class="group-member group-member-plus"
                        ng-cloak>+{{dialogData.userIds.length - dialogLayout.limitMemberDisplay}}</li>
                </ul>
                <a id="find-game"
                   class="btn-primary-xs"
                   ng-show="dialogData.dialogType === dialogType.PARTY && dialogData.party.LeaderUser.Id === chatLibrary.userId && !chatLibrary.inApp"
                   ng-href="{{chatLibrary.gamesPageLink}}">Find Game</a>
                <a id="join-party"
                   class="btn-control-xs"
                   ng-hide="dialogData.dialogType === dialogType.PARTY || !dialogData.party"
                   ng-click="joinParty()">
                    Join Party
                </a>
            </div>

            <div id="party-ingame-header"
                 class="party-ingame-header"
                 ng-show="dialogData.dialogType === dialogType.PARTY && dialogData.isPartyExisted && dialogData.partyInGame"
                 ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.bannerStyle : ''">
                <img ng-src="{{dialogData.placeThumbnail.Url}}"
                     thumbnail="dialogData.placeThumbnail" image-retry
                     class="party-ingame-thumbnail">
                <div class="party-ingame-label"
                     ng-class="{'party-ingame-member': chatLibrary.userId !== dialogData.party.LeaderUser.Id}">
                    <span class="small">Playing</span>
                    <span class="small font-bold text-overflow party-ingame-name">{{dialogData.party.GameName}}</span>
                </div>
                <a id="join-game"
                   class="btn-control-xs"
                   ng-hide="chatLibrary.userId === dialogData.party.LeaderUser.Id"
                   ng-click="joinGame()">
                    Join Game
                </a>
            </div>
            <div id="scrollbar_{{dialogData.dialogType}}_{{dialogData.layoutId}}"
                 ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.dialogStyle : dialogLayout.defaultStyle.dialogStyle"
                 class="rbx-scrollbar dialog-body"
                 dialog-lazy-load>
                <ul class="dialog-messages">
                    <li class="dialog-message-container"
                        ng-repeat="message in dialogData.ChatMessages | reverse"
                        ng-class="{'message-inbound': message.SenderUserId != chatLibrary.userId && !message.isSystemMessage,
                                    'system-message': message.isSystemMessage,
                                    'message-cluster-master': message.isClusterMaster}">
                        <div class="text-date-hint" ng-hide="!message.displayTimeStamp">{{message.displayTimeStamp}}</div>
                        <a ng-href="{{chatLibrary.friendsDict[message.SenderUserId].UserProfileLink}}"
                           ng-click="goToProfile()"
                           ng-hide="message.isSystemMessage"
                           class="avatar avatar-headshot-sm dialog-message-avatar-link">
                            <img ng-if="message.SenderUserId != chatLibrary.userId"
                                 ng-src="{{chatLibrary.friendsDict[message.SenderUserId].AvatarThumb.Url}}"
                                 thumbnail="chatLibrary.friendsDict[message.SenderUserId].AvatarThumb"
                                 image-retry
                                 class="avatar-card-image dialog-message-avatar">
                        </a>
                        <div class="dialog-message dialog-triangle"
                             ng-hide="message.isSystemMessage">
                            <span ng-if="chatLibrary.friendsDict[message.SenderUserId]"
                                  ng-show="message.isClusterMaster && message.SenderUserId != chatLibrary.userId"
                                  class="xsmall dialog-message-author">{{chatLibrary.friendsDict[message.SenderUserId].Username}}</span>
                            <span class="small dialog-message-content" ng-bind-html="message.Content"></span>
                        </div>
                        <div class="xsmall dialog-sending" ng-show="message.sendingMessage">Sending...</div>
                        <div class="text-error dialog-sending" ng-show="message.sendMessageHasError"
                             ng-bind="message.error || 'Error'"></div>
                        <span class="system-message-content"
                              ng-show="message.isSystemMessage"
                              ng-bind-html="message.Content"></span>
                    </li>
                </ul>
            </div>
            <div class="chat-loading loading-top"
                 ng-show="dialogLayout.isChatLoading">
                <img ng-src="{{chatLibrary.spinner}}" alt="loading ...">
            </div>
            <div class="dialog-input-container"
                ng-style="chatLibrary.inApp? dialogLayout.inAppStyle.inputStyle : dialogLayout.defaultStyle.inputStyle">
                <textarea msd-elastic
                          focus-me="{{dialogLayout.focusMeEnabled}}"
                          ng-focus="toggleDialogFocusStatus(true)"
                          ng-blur="toggleDialogFocusStatus(false)"
                          placeholder="Send a message ..."
                          ng-model="dialogData.messageForSend"
                          key-press-enter="keyPressEnter($event)"
                          class="dialog-input"
                          maxlength="{{dialogLayout.limitCharacterCount}}"
                          ng-disabled="chatLibrary.chatLayout.errorMaskEnable"
                          ng-style="chatLibrary.inApp? dialogLayout.inAppStyle.inputStyle : dialogLayout.defaultStyle.inputStyle"></textarea>
                <button class="btn-secondary-sm message-send-btn"
                        ng-show="chatLibrary.inApp && dialogData.messageForSend && dialogData.messageForSend.length > 0"
                        remove-focus>
                    Send
                </button>
            </div>
        </div>
        <div class="group-members-container"
             ng-show="dialogLayout.lookUpMembers">
            <div class="chat-windows-header"
                ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.headerStyle : ''">
                <div class="chat-header-back"
                        ng-click="viewParticipants()">
                    <span class="icon-chat-arrow-left"></span>
                </div>
                <div class="chat-header-label">
                    <span class="font-bold">Participants</span>
                </div>
            </div>
            <div id="group-members" class="rbx-scrollbar chat-friend-list"
                ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.chatBodyHeight : ''">
                <ul class="chat-friends">
                    <li ng-repeat="userId in dialogData.userIds"
                        class="chat-friend">
                        <div class="chat-friend-container">
                            <div class="avatar avatar-headshot-sm card-plain chat-friend-avatar">
                                <img ng-src="{{chatLibrary.friendsDict[userId].AvatarThumb.Url}}"
                                     thumbnail="chatLibrary.friendsDict[userId].AvatarThumb"
                                     image-retry
                                     class="avatar-card-image chat-avatar">
                                <div class="avatar-status chat-friend-status" ng-class="userPresenceTypes[chatLibrary.friendsDict[userId].UserPresenceType]['className']"></div>
                            </div>
                            <div class="chat-friend-info">
                                <span class="text-overflow chat-friend-name">{{chatLibrary.friendsDict[userId].Username}}</span>
                                <span class="small" ng-show="dialogData.party && dialogData.membersDict[userId].memberStatus == memberStatus.LEADER">Leader</span>
                                <span class="small" ng-show="dialogData.party && dialogData.membersDict[userId].memberStatus == memberStatus.MEMBER">In party</span>
                            </div>
                            <div class="group-member-action">
                                <span ng-if="chatLibrary.userId != userId && chatLibrary.userId === dialogData.party.LeaderUser.Id && dialogData.dialogType == dialogType.PARTY"
                                      class="icon-chat-remove"
                                      ng-click="removeMember(userId)"></span>
                                <span ng-if="chatLibrary.userId != userId && chatLibrary.userId === dialogData.InitiatorUser.Id && dialogData.dialogType != dialogType.PARTY"
                                      class="icon-chat-remove"
                                      ng-click="removeMember(userId)"></span>
                                <span class="icon-chat-report-person"
                                      ng-if="chatLibrary.userId != userId"
                                      ng-click="abuseReport(userId, false)"></span>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        <div abuse-report></div>
        <div class="group-friends-container"
             ng-show="dialogData.addMoreFriends">
            <div class="chat-windows-header"
                ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.headerStyle : ''">
                <div class="chat-header-back"
                        ng-click="dialogData.addMoreFriends = false">
                    <span class="icon-chat-arrow-left"></span>
                </div>
                <div class="chat-header-label">
                    <span class="font-bold">Add Friends</span>
                    <span class="font-bold"
                          ng-class="{'group-overload': dialogLayout.isMembersOverloaded}">
                        ({{(dialogData.numberOfSelected)}}/{{chatLibrary.quotaOfPartyMembers}})
                    </span>
                </div>
            </div>
            <div friends-selection
                 class="friends-selection-container"></div>
        </div>
    </div>
</script>

        <!-- ngIf: newGroup --><div dialog="" id="newGroup" dialog-data="newGroup" chat-library="chatLibrary" close-dialog="closeDialog('newGroup')" send-invite="sendInvite(newGroup.layoutId)" ng-if="newGroup" class="ng-scope ng-isolate-scope"></div><!-- end ngIf: newGroup -->
        <script type="text/ng-template" id="chat-new-group">
    <div class="dialog-container group-create-container"
         ng-class="{'collapsed': dialogLayout.collapsed && chatLibrary.deviceType === deviceType.COMPUTER}"
         ng-controller="friendsController">
        <div class="chat-windows-header"
            ng-style="chatLibrary.inApp ? dialogLayout.inAppStyle.headerStyle : ''">
            <div class="chat-header-back"
                    ng-click="closeDialog(dialogData.layoutId)"
                    ng-show="chatLibrary.inApp">
                <span class="icon-chat-arrow-left"></span>
            </div>
            <div class="chat-header-create-group chat-header-label"
                 ng-click="toggleDialogContainer()">
                <span class="font-bold">{{dialogLayout.title}}</span>
                <span class="font-bold"
                      ng-class="{'group-overload': dialogLayout.isMembersOverloaded}">
                    ({{(dialogData.numberOfSelected)}}/{{chatLibrary.quotaOfPartyMembers}})
                </span>
            </div>
            <div class="chat-header-action">
                <span class="icon-chat-close"
                      ng-click="closeDialog(dialogData.layoutId)"
                      ng-hide="chatLibrary.inApp"
                      data-toggle="tooltip"
                      title="Close"></span>
            </div>
        </div>
        <div friends-selection></div>
    </div>
</script>
        <script type="text/ng-template" id="chat-dialog-minimize">
    <div id="dialogs-minimize-container"
         class="dialogs-minimize-container"
         ng-show="hasMinimizedDialogs"
         data-toggle="popover"
         data-bind="dialogs">
        <span class="icon-chat-minimize"></span>
        <span class="minimize-count">{{chatLibrary.minimizedDialogIdList.length}}</span>
        <div class="rbx-popover-content" data-toggle="dialogs">
            <ul class="dropdown-menu minimize-list" role="menu">
                <li ng-repeat="dialogLayoutId in chatLibrary.minimizedDialogIdList"
                    class="minimize-item"
                    id="{{dialogLayoutId}}"
                    minimize-item>
                    <a class="text-overflow minimize-title">
                        <span>
                            {{chatLibrary.minimizedDialogData[dialogLayoutId].name}}
                        </span>
                    </a>
                    <span class="icon-chat-cancel-search minimize-close"></span>
                </li>
            </ul>
        </div>
    </div>
</script>


        <div id="dialogs-minimize" class="dialogs-minimize ng-isolate-scope" dialog-minimize="" chat-library="chatLibrary">
    <div id="dialogs-minimize-container" class="dialogs-minimize-container ng-hide" ng-show="hasMinimizedDialogs" data-toggle="popover" data-bind="dialogs" data-original-title="" title="">
        <span class="icon-chat-minimize"></span>
        <span class="minimize-count ng-binding">0</span>
        <div class="rbx-popover-content" data-toggle="dialogs">
            <ul class="dropdown-menu minimize-list" role="menu">
                <!-- ngRepeat: dialogLayoutId in chatLibrary.minimizedDialogIdList -->
            </ul>
        </div>
    </div>
</div>
        <div class="chat-placeholder ng-scope" chat-placeholder="">
    <div class="chat-placeholder-container ng-hide" ng-show="chatLibrary.chatPlaceholderEnabled">
        <div class="chat-placeholder-header" ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.headerStyle : ''"></div>
        <span class="icon-chat-placeholder"></span>
    </div>
</div>
        <script type="text/ng-template" id="chat-placeholder">
    <div class="chat-placeholder-container"
         ng-show="chatLibrary.chatPlaceholderEnabled">
        <div class="chat-placeholder-header"
             ng-style="chatLibrary.inApp ? chatLibrary.inAppLayout.headerStyle : ''"></div>
        <span class="icon-chat-placeholder"></span>
    </div>
</script>

    </div>

    <script type="text/javascript">
        $(function () {
            // Because of placeLauncher.js, has to add this stupid global "play_placeId"
            $(document).on('Roblox.Chat.PartyInGame', function (event, args) {
                play_placeId = args.placeId;
            });
        });
    </script>

</div>